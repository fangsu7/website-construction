<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device - width, initial - scale=1.0">
  <title>活动管理页面与侧边导航栏</title>
  <style>
    /* 侧边导航栏样式 */
  .sidebar {
      height: 100%;
      width: 200px;
      position: fixed;
      z-index: 1;
      top: 0;
      left: 0;
      background-color: #111;
      overflow-x: hidden;
      padding-top: 20px;
    }

  .sidebar a {
      padding: 6px 8px 6px 16px;
      text-decoration: none;
      font-size: 20px;
      color: #818181;
      display: block;
    }

  .sidebar a:hover {
      color: #f1f1f1;
    }

    /* 活动管理页面表格样式 */
    table {
      border-collapse: collapse;
      width: 100%;
    }

    th,
    td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
    }

    th {
      background-color: #f2f2f2;
    }

    button {
      margin: 2px;
    }

    /* 让内容区域避开导航栏 */
    body {
      margin-left: 200px;
    }

    /* 表单样式 */
    form {
      background-color: #fff;
      padding: 0px;
      border: 0px solid #ccc;
      border-radius: 5px;
      box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
      margin: 0;
    }

    label {
      display: block;
      margin-bottom: 5px;
    }

    input[type="text"],
    input[type="date"],
    textarea {
      width: 100%;
      padding: 8px;
      margin-bottom: 15px;
      border: 1px solid #ccc;
      border-radius: 3px;
    }

    input[type="submit"] {
      background-color: #333;
      color: white;
      padding: 10px 15px;
      border: none;
      border-radius: 3px;
      cursor: pointer;
    }

    input[type="submit"]:hover {
      background-color: #555;
    }
  </style>
</head>

<body>
  <!-- 侧边导航栏 -->
  <div class="sidebar">
    <a href="/userData">用户管理</a>
    <a href="/activityData">活动管理</a>
  </div>

  <!-- 活动管理页面内容 -->
  <h1>已发布活动</h1>
  <table id="activityTable">
    <thead>
      <tr >
        <th >活动编号</th>
        <th>活动名称</th>
        <th>活动地点</th>
        <th>活动时间</th>
        <th>活动简介</th>
        <th>操作</th>
      </tr>
    </thead>
    <tbody>
      <!-- 活动数据将由JavaScript动态添加 -->
      <tr th:each="activity : ${activities}">
        <td th:text="${activity.activityId}">活动编号</td>
        <td th:text="${activity.activityName}">活动名称</td>
        <td th:text="${activity.activityLocation}">活动地点</td>
        <td th:text="${activity.activityTime}">活动时间</td>
        <td th:text="${activity.activityDescription}">活动简介</td>
        <td>
          <button type="button" th:data-stuid="${activity.activityId}" class="editBtn">编辑</button>
          <form th:action="@{/activityData/delete/{activityId}(activityId=${activity.activityId})}" method="post" style="display: inline">
            <button type="submit" th:data-stuid="${activity.activityId}" onclick="return confirm('确定删除该用户吗？')" class="deleteBtn">删除</button>
          </form>

        </td>
        </tr>
    </tbody>
  </table>
  <button id="addButton">添加活动</button>

  <!-- 添加活动表单（初始隐藏） -->
  <form th:action="@{/activityData}" th:object="${activity}" method="POST" id="addActivityForm" style="display: none;">
    <h2>添加活动</h2>
    <label for="activityId">活动编号：</label>
    <input th:field="*{activityId}" type="text" id="activityId" required><br>
    <div th:if="${#fields.hasErrors('activityId')}" th:errors="*{activityId}"></div>

    <label for="addName">活动名称：</label>
    <input th:field="*{activityName}" type="text" id="addName" required><br>
    <div th:if="${#fields.hasErrors('activityName')}" th:errors="*{activityName}"></div>

    <label for="addLocation">活动地点：</label>
    <input th:field="*{activityLocation}" type="text" id="addLocation" required><br>
    <div th:if="${#fields.hasErrors('activityLocation')}" th:errors="*{activityLocation}"></div>

    <label for="addTime">活动时间：</label>
    <input th:field="*{activityTime}" type="datetime-local" id="addTime" required><br>
    <div th:if="${#fields.hasErrors('activityTime')}" th:errors="*{activityTime}"></div>
<!--    <input type="date" id="addTime" required><br>-->
    <label for="addDescription">活动简介：</label>
    <textarea th:field="*{activityDescription}" id="addDescription" required></textarea><br>
<!--    <textarea id="addDescription" required></textarea><br>-->
    <input type="submit" value="提交">
  </form>

  <!-- 编辑活动表单（初始隐藏） -->
  <form th:action="@{/activityData/update}"th:object="${activity}"method="POST" id="editActivityForm" style="display: none;">
    <h2>编辑活动</h2>
    <label for="editName">活动名称：</label>
    <input type="text" id="editName" th:field="*{activityName}" required><br>
    <div th:if="${#fields.hasErrors('activityName')}" th:errors="*{activityName}"></div>

    <label for="editLocation">活动地点：</label>
    <input type="text" id="editLocation" th:field="*{activityLocation}" required><br>
    <div th:if="${#fields.hasErrors('activityLocation')}" th:errors="*{activityLocation}"></div>

    <label for="editTime">活动时间：</label>
    <input type="datetime-local" id="editTime" th:field="*{activityTime}" required><br>
    <div th:if="${#fields.hasErrors('activityTime')}" th:errors="*{activityTime}"></div>

    <label for="editDescription">活动简介：</label>
    <textarea id="editDescription" th:field="*{activityDescription}" required></textarea><br>
    <input type="hidden" th:field="*{activityId}" id="editActivityId">
    <input type="submit" value="保存修改">
  </form>

  <script>
    // 模拟活动数据
    let activities = [];



    // 显示添加活动表单
    document.getElementById('addButton').addEventListener('click', () => {
      document.getElementById('addActivityForm').style.display = "block";
    });

    // 绑定编辑按钮事件
    document.querySelectorAll('.editBtn').forEach(button => {
      button.addEventListener('click', function () {
        const activityId = this.getAttribute('data-stuid');
        editActivity(activityId);
      });
    });



    // 编辑活动
    function editActivity(activityId) {
        const row = document.querySelector(`button.editBtn[data-stuid="${activityId}"]`).closest('tr');
        const activityIdCell = row.querySelector('td:nth-child(1)').textContent.trim();
        const activityNameCell = row.querySelector('td:nth-child(2)').textContent.trim();
        const activityLocationCell = row.querySelector('td:nth-child(3)').textContent.trim();
        const activityTimeCell = row.querySelector('td:nth-child(4)').textContent.trim();
        const activityDescriptionCell = row.querySelector('td:nth-child(5)').textContent.trim();

        //填充编辑表单
        document.getElementById('editActivityId').value = activityId;
        document.getElementById('editName').value = activityNameCell;
        document.getElementById('editLocation').value = activityLocationCell;
        // document.getElementById('editTime').value = activityTimeCell;
        document.getElementById('editDescription').value = activityDescriptionCell;
        //转换时间格式
        const datetimeLocal = new Date(activityTimeCell).toISOString().slice(0,16);
        document.getElementById('editTime').value = datetimeLocal;
        //显示编辑表单，隐藏添加表单
        document.getElementById('editActivityForm').style.display = "block";
        document.getElementById('addActivityForm').style.display = "none";

    }

  </script>
</body>

</html>